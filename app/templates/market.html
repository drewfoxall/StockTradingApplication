<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy/Sell Stocks</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/stylesheet.css') }}"
    />
  </head>
  <body>
    <div class="topnav">
      <a href="{{ url_for('index') }}"> Home </a>
      <a href="{{ url_for('portfolio') }}"> Portfolio </a>
      <div class="topnav-right">
        <a href="{{ url_for('login') }}"> Log in </a>
        <a href="{{ url_for('signup') }}"> Sign Up </a>
      </div>
    </div>

    <div class="buy-sell-container">
      <h1>Buy/Sell Stocks</h1>

      <section>
        <h2>Buy Stocks</h2>
        <form id="buy-form">
          <label for="buy-stock-ticker">Stock Ticker:</label>
          <input
            type="text"
            id="buy-stock-ticker"
            placeholder="Enter stock ticker"
            required
          />

          <label for="buy-quantity">Quantity:</label>
          <input
            type="number"
            id="buy-quantity"
            placeholder="Enter quantity"
            required
          />

          <button type="submit">Buy</button>
        </form>
      </section>

      <section>
        <h2>Sell Stocks</h2>
        <form id="sell-form">
          <label for="sell-stock-ticker">Stock Ticker:</label>
          <input
            type="text"
            id="sell-stock-ticker"
            placeholder="Enter stock ticker"
            required
          />

          <label for="sell-quantity">Quantity:</label>
          <input
            type="number"
            id="sell-quantity"
            placeholder="Enter quantity"
            required
          />

          <button type="submit">Sell</button>
        </form>
      </section>

      <div id="transaction-message"></div>
    </div>

    <footer class="footer">
      Stock Trading Program created by Andrew Foxall, Ken Lai, and Sam Nhean
    </footer>

    <script>
      const buyForm = document.getElementById("buy-form");
      const sellForm = document.getElementById("sell-form");
      const transactionMessage = document.getElementById("transaction-message");

      buyForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const ticker = document
          .getElementById("buy-stock-ticker")
          .value.toUpperCase();
        const quantity = parseInt(
          document.getElementById("buy-quantity").value
        );

        // Save to local storage
        let portfolio = JSON.parse(localStorage.getItem("portfolio")) || {};
        if (portfolio[ticker]) {
          portfolio[ticker].shares += quantity;
        } else {
          portfolio[ticker] = {
            name: "Stock Name Placeholder", // Update this with actual stock name from an API
            shares: quantity,
            price: 0, // You could store the current price here if available
          };
        }
        localStorage.setItem("portfolio", JSON.stringify(portfolio));

        transactionMessage.textContent = `Successfully bought ${quantity} shares of ${ticker}.`;
        buyForm.reset();
      });

      sellForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const ticker = document
          .getElementById("sell-stock-ticker")
          .value.toUpperCase();
        const quantity = parseInt(
          document.getElementById("sell-quantity").value
        );

        let portfolio = JSON.parse(localStorage.getItem("portfolio")) || {};
        if (portfolio[ticker] && portfolio[ticker].shares >= quantity) {
          portfolio[ticker].shares -= quantity;
          if (portfolio[ticker].shares === 0) {
            delete portfolio[ticker];
          }
          localStorage.setItem("portfolio", JSON.stringify(portfolio));
          transactionMessage.textContent = `Successfully sold ${quantity} shares of ${ticker}.`;
        } else {
          transactionMessage.textContent = `Not enough shares to sell.`;
        }
        sellForm.reset();
      });
    </script>
  </body>
</html>
