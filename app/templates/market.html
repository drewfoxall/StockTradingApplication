<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy/Sell Stocks</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/stylesheet.css') }}"
    />
  </head>
  <body>
    <div class="topnav">
      <a href="{{ url_for('index') }}"> Home </a>
      <a href="{{ url_for('view_portfolio') }}"> Portfolio </a>
      {% if current_user.is_authenticated %}
        <a href="{{url_for('market') }}"> Market </a>
        {% if current_user.is_admin %}
        <a href="{{url_for('administrator')}}"> Administrator </a>
        {% endif %}
      {% endif %}
      <div class="topnav-right">
        {% if current_user.is_authenticated %}
          <!-- Show Sign Out link when the user is logged in -->
          <a href="{{ url_for('logout') }}"> Sign Out </a>
          
        {% else %}
          <!-- Show Log in and Sign Up links when the user is not logged in -->
          <a href="{{ url_for('login') }}"> Log In </a>
          <a href="{{ url_for('signup') }}"> Sign Up </a>
        {% endif %}
      </div>
    </div>
    <div class="market-status">
      Market Status: 
      {% if is_market_open %}
          <span class="status-open">Open</span>
      {% else %}
          <span class="status-closed">Closed</span>
      {% endif %}
    </div>
    <div class="buy-sell-container">
      <h1>Buy/Sell Stocks</h1>
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
          <ul class="flashes">
              {% for category, message in messages %}
                  <li class="{{ category }}">{{ message }}</li>
              {% endfor %}
          </ul>
      {% endif %}
      {% endwith %}
      <!DOCTYPE html>
<html lang="en">
<head>
  </head>
<body>
  <div class="buy-sell-container">
    <h2>Buy Stocks</h2>
    <table>
      <tbody>
        {% for stock_item in all_stocks %}
        <tr>
          <td>{{ stock_item.ticker }}</td>
          <td>{{ stock_item.company_name }}</td>
          <td>${{ "%.2f"|format(stock_item.price) }}</td>
          <td>{{ stock_item.volume }}</td>
          <td>
            <form 
              id="buy-form-{{ stock_item.stock_id }}"  
              action="{{ url_for('buy_stock', stock_id=stock_item.stock_id) }}" 
              method="POST">
              <input type="number" name="quantity" min="1" max="{{ stock_item.volume }}" placeholder="Quantity" required />
              <button type="submit" class="btn">Buy</button>
            </form>
            <script>
              document.getElementById('buy-form-{{ stock_item.stock_id }}').addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent default submission
                if (confirm('Are you sure you want to buy this stock?')) {
                  this.submit(); // Submit the form if confirmed
                } else {
                  // Optionally, you can reset the form or clear the input field here
                  // Example: this.reset(); 
                }
              });
            </script>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <h2>Sell Stocks</h2>
    <table>
      <tbody>
        {% for stock_item in user_stocks %}
        <tr>
          <td>{{ stock_item.ticker }}</td>
          <td>{{ stock_item.company_name }}</td>
          <td>{{ stock_item.price }}</td>
          <td>{{ stock_item.stock_portfolios[0].quantity }}</td>
          <td>
            <form 
              id="sell-form-{{ stock_item.stock_id }}"  {# Add ID to the form #}
              action="{{ url_for('sell_stock', stock_id=stock_item.stock_id) }}" 
              method="POST">
              <input type="number" name="quantity" min="1" max="{{ stock_item.stock_portfolios[0].quantity }}" placeholder="Quantity" required />
              <button type="submit" class="btn">Sell</button>
            </form>
            <script>
              document.getElementById('sell-form-{{ stock_item.stock_id }}').addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent default submission
                if (confirm('Are you sure you want to sell this stock?')) {
                  this.submit(); // Submit the form if confirmed
                }
              });
            </script>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>